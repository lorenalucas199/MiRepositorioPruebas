<!DOCTYPE html>
<html lang="es-ES">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Concepto de continuidad</title>
  <link rel="stylesheet" href="miestilo.css" />
  
  <!-- MathJax para mostrar matemáticas -->
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] },
      TeX: {
        Macros: {
          R: "{\\mathbb R}"
        },
        equationNumbers: { autoNumber: "AMS" }
      }
    });
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_HTML" async></script>

  <!-- Algebra.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/algebra.js/0.2.6/algebra.min.js"></script>

  <style>
    body {
      font-family: 'Rubik', sans-serif;
      background: linear-gradient(to bottom, #FF7F50, #FFDAB9);
      text-align: center;
      padding: 20px;
    }
    canvas {
      border: 1px solid black;
      margin-top: 20px;
    }
  </style>
</head>

<body>
  <h1>¿Qué es la continuidad?</h1>
  <p>
    Una función $f(x)$ es <strong>continua en un punto $x=a$</strong> si:
    $$\lim_{x \\to a^-} f(x) = \lim_{x \\to a^+} f(x) = f(a)$$
    Es decir, no hay "saltos" ni "agujeros" en la gráfica.
  </p>

  <h3>Escribe una función $f(x)$ (en JavaScript):</h3>
  <input type="text" id="funcionintro" value="(x < 1) ? x : x+1">
  <br><br>
  <button onclick="graficar()">Graficar</button>
  <button onclick="zoomIn()"> + </button>
  <button onclick="zoomOut()"> - </button>
  <br><br>

  <canvas id="canvas" width="600" height="400"></canvas>
  <p id="mensajeContinuidad"></p>

  <script>
    var c = document.getElementById("canvas");
    var ctx = c.getContext("2d");
    let zoom = 40;

    function transformarX(x){ return c.width/2 + x*zoom; }
    function transformarY(y){ return c.height/2 - y*zoom; }
    function convertirX(px){ return (px - c.width/2)/zoom; }

    function derivada(f, x, h=0.001){ return (f(x+h) - f(x))/h; }

    function graficar(){
      ctx.clearRect(0, 0, c.width, c.height);
      dibujarEjes();

      const expr = document.getElementById("funcionintro").value;
      let f;
      try {
        f = new Function("x", "return " + expr);
      } catch {
        alert("Error en la función. Asegúrate de escribir código JavaScript válido.");
        return;
      }

      dibujarFuncion(f);
      comprobarContinuidad(f, 1); // comprobamos en x = 1
    }

    function dibujarEjes(){
      ctx.strokeStyle = "black";
      ctx.beginPath();
      ctx.moveTo(0, transformarY(0));
      ctx.lineTo(c.width, transformarY(0));
      ctx.moveTo(transformarX(0), 0);
      ctx.lineTo(transformarX(0), c.height);
      ctx.stroke();
    }

    function dibujarFuncion(f){
      ctx.strokeStyle = "blue";
      ctx.beginPath();
      let inicio = convertirX(0);
      for(let x = inicio; x < convertirX(c.width); x += 0.05){
        let y = f(x);
        if (!isNaN(y) && isFinite(y)) {
          ctx.lineTo(transformarX(x), transformarY(y));
        } else {
          ctx.moveTo(transformarX(x), transformarY(0));
        }
      }
      ctx.stroke();
    }

    function comprobarContinuidad(f, a){
      let mensaje = document.getElementById("mensajeContinuidad");

      const izquierda = f(a - 0.001);
      const derecha = f(a + 0.001);
      const valor = f(a);

      let tolerancia = 0.01;
      let continua = Math.abs(izquierda - derecha) < tolerancia && Math.abs(valor - izquierda) < tolerancia;

      if (continua) {
        mensaje.innerHTML = `<strong>La función es continua en x = ${a}</strong>`;
        mensaje.style.color = "green";
      } else {
        mensaje.innerHTML = `<strong>La función NO es continua en x = ${a}</strong><br>
        \\( \\lim_{x \\to ${a}^-} f(x) = ${izquierda.toFixed(2)} \\), 
        \\( \\lim_{x \\to ${a}^+} f(x) = ${derecha.toFixed(2)} \\), 
        \\( f(${a}) = ${valor.toFixed(2)} \\)`;
        mensaje.style.color = "red";
        MathJax.Hub.Queue(["Typeset", MathJax.Hub, mensaje]);
      }
    }

    function zoomIn(){ zoom *= 1.2; graficar(); }
    function zoomOut(){ zoom /= 1.2; graficar(); }
  </script>
</body>
</html>
