<!DOCTYPE html>
<html lang="es-ES">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Matemáticas Dinámicas</title>
    <link rel="stylesheet" href="miestilo.css">
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        processEscapes: true
      },
      TeX: {
        Macros: {
          R: "{\\mathbb R}",
          N: "{\\mathbb N}",
          Z: "{\\mathbb Z}",
          bold: ["{\\bf #1}",1],
          extensions: ["AMSmath.js", "AMSsymbols.js", "color.js"]
        },
        equationNumbers: { autoNumber: "AMS" }
      }
    });
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_HTML' async></script>
</head>
<body>
    <h1>¡La recta tangente!</h1>
    <h3>de Lorena Lucas Baños</h3>
    
    <label for="funcion">Ingresa una función f(x) (en formato JavaScript): </label>
    <input type="text" id="funcion" value="Math.sin(x)">
    <button onclick="graficar()">Graficar</button>
    
    <br><br>
    
    <!-- Crear el elemento canvas con la clase "recuadro" definida en miestilo.css -->
    <canvas id="myCanvas1" width="600" height="400" class="recuadro"></canvas>

    <script>
        const canvas = document.getElementById("myCanvas1");
        const ctx = canvas.getContext("2d");
        let f;
        let xPunto = 0;
        let zoom = 40;
        let offsetX = 0, offsetY = 0;
        let isDragging = false;
        let startX, startY;
        
        function ajustarCanvas() {
            canvas.width = window.innerWidth * 0.8;
            canvas.height = window.innerHeight * 0.6;
        }
        
        function derivada(f, x, h = 0.001) {
            return (f(x + h) - f(x)) / h;
        }
        
        function transformarX(x) { return canvas.width / 2 + (x + offsetX) * zoom; }
        function transformarY(y) { return canvas.height / 2 - (y + offsetY) * zoom; }
        function invertirX(px) { return (px - canvas.width / 2) / zoom - offsetX; }
        
        function graficar() {
            ajustarCanvas();
            const inputFuncion = document.getElementById("funcion").value;
            try {
                f = new Function("x", "return " + inputFuncion);
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                dibujarEjes();
                dibujarFuncion(f, "blue");
                dibujarFuncion(x => derivada(f, x), "red");
                dibujarPuntoTangente();
            } catch (e) {
                alert("Error en la función ingresada");
            }
        }
        
        function dibujarEjes() {
            ctx.strokeStyle = "black";
            ctx.beginPath();
            ctx.moveTo(0, transformarY(0));
            ctx.lineTo(canvas.width, transformarY(0));
            ctx.moveTo(transformarX(0), 0);
            ctx.lineTo(transformarX(0), canvas.height);
            ctx.stroke();
        }
        
        function dibujarFuncion(f, color) {
            ctx.strokeStyle = color;
            ctx.beginPath();
            for (let x = invertirX(0); x < invertirX(canvas.width); x += 0.05) {
                let y = f(x);
                if (isFinite(y)) {
                    ctx.lineTo(transformarX(x), transformarY(y));
                }
            }
            ctx.stroke();
        }
        
        function dibujarPuntoTangente() {
            let yPunto = f(xPunto);
            let pendiente = derivada(f, xPunto);
            
            ctx.fillStyle = "green";
            ctx.beginPath();
            ctx.arc(transformarX(xPunto), transformarY(yPunto), 5, 0, 2 * Math.PI);
            ctx.fill();
            
            ctx.strokeStyle = "orange";
            ctx.beginPath();
            let x1 = xPunto - 1;
            let y1 = yPunto - pendiente;
            let x2 = xPunto + 1;
            let y2 = yPunto + pendiente;
            ctx.moveTo(transformarX(x1), transformarY(y1));
            ctx.lineTo(transformarX(x2), transformarY(y2));
            ctx.stroke();
        }
        
        window.addEventListener("resize", () => {
            ajustarCanvas();
            graficar();
        });
        
        ajustarCanvas();
        graficar();
    </script>
</body>
</html>
